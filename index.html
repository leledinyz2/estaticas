<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ðŸŽµ Placar Just Dance do Lele ðŸŽµ</title>
<style>
  body { font-family: "Poppins", sans-serif; background:#0d0d0d; color:#f4f4f4; margin:0 }
  header { background:#b30a3c; text-align:center; padding:20px; font-size:1.6rem; font-weight:600; color:#fff; border-radius:0 0 10px 10px; }
  .container { max-width:980px; margin:30px auto; padding:20px; background:#111; border-radius:10px; box-shadow:0 4px 20px rgba(255,255,255,0.04); overflow-x:auto; }
  .controls { display:flex; gap:12px; flex-wrap:wrap; margin-bottom:8px; align-items:center; }
  label { font-size:0.9rem; color:#ddd }
  select,input { padding:8px 10px; border-radius:6px; border:1px solid #333; background:#161616; color:#fff }
  table { width:100%; border-collapse:collapse; margin-top:12px; table-layout:fixed; word-wrap:break-word; }
  th,td { padding:10px; border-bottom:1px solid #222; text-align:left; vertical-align:middle }
  th { color:#ff88b3; font-weight:600 }
  tr:hover { background:#1a1a1a }
  footer { text-align:center; color:#999; margin-top:16px; font-size:0.9rem }
  .small { font-size:0.85rem; color:#aaa; margin-left:8px }
</style>
</head>
<body>
<header>ðŸŽµ Placar Just Dance do Lele ðŸŽµ</header>

<div class="container">
  <div class="controls">
    <div>
      <label>Filtro por estrelas mÃ­nimas:</label><br>
      <select id="filtroEstrelas"><option value="0">Todas</option><option value="1">1+</option><option value="2">2+</option><option value="3">3+</option><option value="4">4+</option><option value="5">5</option></select>
    </div>
    <div style="flex:1">
      <label>Buscar mÃºsica:</label><br>
      <input id="buscaMusica" type="text" placeholder="Digite o nome..." style="width:100%"/>
    </div>
  </div>

  <div class="small" id="detectedHeaders"></div>

  <table id="tabela" aria-live="polite">
    <thead>
      <tr>
        <th>MÃºsica</th>
        <th>VersÃ£o</th>
        <th>PontuaÃ§Ã£o</th>
        <th>Estrelas</th>
        <th>Jogo</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <footer>Atualiza automaticamente com base na planilha do Lele ðŸ’ƒ</footer>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTas34kcpM1cQdW2oR_XjNlINTVShbwfTyVdYnBe2glvdvlJbcDlbQ0npgTdJZ_6p-tQgozmHmnsCQy/pub?gid=0&single=true&output=csv";

// --- parser CSV robusto ---
function parseCSV(text) {
  const rows = [];
  let i = 0, cur = '', row = [], inQuotes = false;
  while (i < text.length) {
    const ch = text[i];
    if (inQuotes) {
      if (ch === '"') {
        if (text[i+1] === '"') { cur += '"'; i += 2; continue; }
        inQuotes = false; i++; continue;
      } else { cur += ch; i++; continue; }
    } else {
      if (ch === '"') { inQuotes = true; i++; continue; }
      if (ch === ',') { row.push(cur); cur = ''; i++; continue; }
      if (ch === '\r') { i++; continue; }
      if (ch === '\n') { row.push(cur); rows.push(row); row = []; cur = ''; i++; continue; }
      cur += ch; i++;
    }
  }
  if (cur !== '' || row.length) row.push(cur);
  if (row.length) rows.push(row);
  return rows;
}

async function carregarDados() {
  const res = await fetch(CSV_URL);
  const text = await res.text();
  const parsed = parseCSV(text);
  const headers = parsed[0].map(h => h.trim());
  const dados = parsed.slice(1).map(r => {
    const obj = {};
    headers.forEach((h, i) => {
      obj[h] = (r[i] || "").replace(/[\r\n]+/g, " ").trim();
    });
    return obj;
  });
  return { headers, dados };
}

function detectColumns(headers) {
  const find = (names) => headers.find(h => names.some(n => h.toLowerCase().includes(n))) || null;
  return {
    musica: find(["mÃºsica", "musica", "song"]) || headers[0],
    versao: find(["versÃ£o", "versao", "version"]) || headers[1],
    pontuacao: find(["pontuaÃ§Ã£o", "pontuacao", "score"]) || headers[2],
    estrelas: find(["estrela", "estrelas", "stars"]) || null,
    jogo: find(["jogo", "game"]) || headers[headers.length - 1],
  };
}

function exibirTabela(dados, cols) {
  const tbody = document.querySelector("#tabela tbody");
  tbody.innerHTML = "";
  dados.forEach(d => {
    const eRaw = d[cols.estrelas] || "";
    let estrelasHTML = "";
    const num = parseInt(eRaw.replace(/[^\d]/g, ""));
    if (!isNaN(num) && num > 0 && num <= 5) {
      estrelasHTML = "ðŸ’›".repeat(num);
    } else if (eRaw.includes("â­") || eRaw.includes("ðŸ’›")) {
      estrelasHTML = eRaw; // jÃ¡ tem sÃ­mbolo
    } else {
      estrelasHTML = ""; // vazio
    }

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${d[cols.musica] || ""}</td>
      <td>${d[cols.versao] || ""}</td>
      <td>${d[cols.pontuacao] || ""}</td>
      <td>${estrelasHTML}</td>
      <td>${d[cols.jogo] || ""}</td>
    `;
    tbody.appendChild(tr);
  });
}

function aplicarFiltros() {
  const min = parseInt(document.querySelector("#filtroEstrelas").value);
  const busca = document.querySelector("#buscaMusica").value.toLowerCase();
  const filtrado = ALL.filter(d => {
    const eRaw = d[cols.estrelas] || "";
    const num = parseInt(eRaw.replace(/[^\d]/g, "")) || 0;
    const nome = (d[cols.musica] || "").toLowerCase();
    return num >= min && nome.includes(busca);
  });
  exibirTabela(filtrado, cols);
}

let ALL = [];
let cols = null;
(async function init(){
  const { headers, dados } = await carregarDados();
  ALL = dados;
  cols = detectColumns(headers);
  exibirTabela(ALL, cols);
})();
document.querySelector("#filtroEstrelas").addEventListener("change", aplicarFiltros);
document.querySelector("#buscaMusica").addEventListener("input", aplicarFiltros);
</script>
</body>
</html>
